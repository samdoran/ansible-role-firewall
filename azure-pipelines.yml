trigger:
  - master
  - main


jobs:
  - job: Linux
    displayName: Test
    pool:
      vmImage: ubuntu-20.04
    strategy:
      matrix:
        CentOS 6:
          vmImage: ubuntu-20.04
          MOLECULE_DISTRIBUTION: centos6
        CentOS 7:
          MOLECULE_DISTRIBUTION: centos7
        CentOS 8:
          MOLECULE_DISTRIBUTION: centos8
        # Debian 8:
        #   MOLECULE_DISTRIBUTION: debian8
        # Debian 9:
        #   MOLECULE_DISTRIBUTION: debian9
        # Debian 10:
        #   MOLECULE_DISTRIBUTION: debian10

    steps:
      - checkout: self
        path: firewall

      - script: |
          export PATH=/home/vsts/.local/bin:$PATH
          pip3 install molecule[lint]==3.0.6 docker
          molecule test
        displayName: Molecule

  - job: macOS
    displayName: Test macOS
    pool:
      vmImage: macOS-10.14
    steps:
      - checkout: self
        path: firewall

      - script: |
          pip3 install ansible-base
          ansible --version
          cd ../
          ansible localhost -m import_role -a 'name=firewall'
